---
title: "Final project: Group 1"
format:
  html:
    embed-resources: true
editor: visual
---

## Members

-   Anna Lifousi (`s232979`)
-   Jordan Sylvester Fernandes (`s222497`)
-   Manuel Arcieri (`s230158`)
-   Quim Bech Vilaseca (`s233374`)
-   Xavier Vi√±as Margalef (`s233532`)

## Load data

### Load libraries

```{r}
#| echo: true
#| message: true

library("broom")
library("patchwork")
library("purrr")
library("readr")
library("stringr")
library("table1")
library("tidyverse")
```

### Download diabetes dataset

```{r}
#| echo: true
#| message: true

raw_dir <- "../_raw/"
data_file <- "diabetes.csv"
data_loc <- "https://r4bds.trifogli.rip/"

if (!dir.exists(raw_dir)) {
    dir.create(path = raw_dir)
}

if(!file.exists(str_c(raw_dir, data_file))){
  download.file(
    url = str_c(data_loc, data_file),
    destfile = str_c(raw_dir, data_file))
}
```

### Save dataset in data as tsv
```{r}
data <- read_csv("../_raw/diabetes.csv", col_types = cols(
  Pregnancies = col_integer(),
  Glucose = col_integer(),
  BloodPressure = col_integer(),
  SkinThickness = col_integer(),
  Insulin = col_integer(),
  BMI = col_number(),
  DiabetesPedigreeFunction = col_number(),
  Age = col_integer(),
  Outcome = col_integer()
))

data_dir <- '../data/'

if (!dir.exists(data_dir)) {
    dir.create(path = data_dir)
}

write_tsv(data, file = str_c(data_dir, '01_dat_load.tsv.gz'))
```

## Clean data

```{r}
data <- read_tsv('../data/01_dat_load.tsv.gz', col_types = cols(
  Pregnancies = col_integer(),
  Glucose = col_integer(),
  BloodPressure = col_integer(),
  SkinThickness = col_integer(),
  Insulin = col_integer(),
  BMI = col_number(),
  DiabetesPedigreeFunction = col_number(),
  Age = col_integer(),
  Outcome = col_integer()
  ))

columns_to_replace <- c("Glucose", "BloodPressure", "SkinThickness", "BMI","DiabetesPedigreeFunction", "Age")

data <- data |> 
  mutate_at(.vars = columns_to_replace, ~ifelse(. == 0, NA, .)) |>
  rename(BP = BloodPressure,
         Skin_thick = SkinThickness,
         DPF = DiabetesPedigreeFunction) |>
  mutate(Insulin = ifelse(Outcome == 0 & Insulin == 0, NA, Insulin))

View(data)

write_tsv(data, file = '../data/02_dat_clean.tsv.gz')
```

## Describe data

To address the description of the dataset, we are going calculate the basic statistics of the dataset, and also what they are about.

```{r}
data <- read_tsv('../data/02_dat_clean.tsv.gz', col_types = cols(
  Pregnancies = col_integer(),
  Glucose = col_integer(),
  BP = col_integer(),
  Skin_thick = col_integer(),
  Insulin = col_integer(),
  BMI = col_number(),
  DPF = col_number(),
  Age_onset = col_integer(),
  Outcome = col_integer()
  ))
summary(data)
```

### Pregnancies
The pregnancies attributes corresponds to the number of pregnancies that the patient has had. It only has discrete values that go from 0 to 17, with an median value of 3 pregnancies. 

### Plasma Glucose Concentration
This attribute shows the concentration of glucose in the patients blood in mg/dL. It has continuous data and the base and max value are 44 mg/dL and 199 mg/dL, accordingly. Moreover, the mean value is 121.7 mg/dL.

### Diastolic Blood Pressure
The diastolic blood pressure is a continuous value that has as units mm Hg, and it has as minimum and maximum values 24 mm Hg and 122 mm Hg, respectively. Furthermore, the mean value is 72.41 mm Hg. However, it lacks a true zero point. A blood pressure equal of zero is not the absence of blood pressure; it's a theoretical minimum point.

### Triceps Skin Fold
The Skin Thickness attribute describes the triceps skin fold measure, which 

## Augment data

```{R}
data <- read_tsv('../data/02_dat_clean.tsv.gz', col_types = cols(
  Pregnancies = col_integer(),
  Glucose = col_integer(),
  BP = col_integer(),
  Skin_thick = col_integer(),
  Insulin = col_integer(),
  BMI = col_number(),
  DPF = col_number(),
  Age_onset = col_integer(),
  Outcome = col_integer()
  ))



write_tsv(data, file = '../data/03_dat_aug.tsv.gz')
```

## Analyse data

...
